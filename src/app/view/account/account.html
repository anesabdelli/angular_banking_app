<div class="account-root">
  <h2>Mon espace compte</h2>

  <div class="welcome">
    {{ user ? 'Bienvenue, ' + user.name : '' }}
  </div>

  <div class="error">{{ error() || '' }}</div>
  <div class="loading">{{ loading() ? 'Chargement...' : '' }}</div>

  <div *ngIf="!loading() && accounts().length > 0; else noAccounts">

    <!-- Sélecteur de compte -->
    <div class="account-selector">
      <label for="accountSelect">Choisir un compte :</label>
      <select id="accountSelect" (change)="onAccountChange($event)">
        <option
          *ngFor="let acc of accounts()"
          [value]="acc.id"
          [selected]="account() && account()!.id === acc.id">
          {{ acc.label || acc.id }} — {{ acc.balance | currency:'EUR':'symbol':'1.2-2' }}
        </option>
      </select>
    </div>

    <!-- Détails compte -->
    <section class="account-details" *ngIf="account()">
      <h3>{{ account()!.label || 'Compte ' + account()!.id }}</h3>
      <p><strong>Solde :</strong> {{ account()!.balance | currency:'EUR':'symbol':'1.2-2' }}</p>
      <p><strong>Ouvert le :</strong> {{ account()!.openAt | date:'dd/MM/yyyy HH:mm' }}</p>

      <div class="actions">
        <button (click)="onInfosClick()">Infos</button>
        <button (click)="onSendClick()">Envoyer</button>
        <button (click)="onOpenClick()">Ouvrir un nouveau compte</button>
        <button (click)="onViewAllClick()">Historique transactions</button>

      </div>
    </section>

    <!-- SECTION TRANSACTIONS -->
    <section class="transactions-section" *ngIf="account()">
      <h3>Historique des transactions</h3>

      <div *ngIf="transactionsLoading()">Chargement des transactions...</div>
      <div *ngIf="transactionsError()" class="error">{{ transactionsError() }}</div>

      <div *ngIf="!transactionsLoading() && transactions().length === 0 && !transactionsError()">
        Aucune transaction pour ce compte.
      </div>

      <table *ngIf="transactions().length > 0" class="transactions-table">
        <thead>
          <tr>
            <th>Date</th>
            <th>Description</th>
            <th>Montant</th>
            <th>Type</th>
            <th>Autre partie</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let tx of transactions()">
            <td>{{ tx.emittedAt | date:'dd/MM/yyyy HH:mm' }}</td>
            <td>{{ tx.description || '(sans description)' }}</td>
            <td 
              [class.debit]="tx.emitter.id === account()?.id"
              [class.credit]="tx.receiver.id === account()?.id">
              {{ tx.amount | currency:'EUR':'symbol':'1.2-2' }}
            </td>
            <td>{{ tx.emitter.id === account()?.id ? 'Débit' : 'Crédit' }}</td>
            <td>
              {{ tx.emitter.id === account()?.id 
                ? 'Vers ' + tx.receiver.owner.name 
                : 'De ' + tx.emitter.owner.name }}
            </td>
          </tr>
        </tbody>
      </table>
    </section>

    <!-- Formulaire création compte -->
    <div *ngIf="showCreateForm()" class="create-form">
      <h3>Créer un nouveau compte</h3>
      <!-- ... le formulaire reste identique ... -->
      <div class="form-group">
        <label for="label">Nom / Libellé :</label>

        <input
          id="label"
          type="text"
          placeholder="ex: Compte Courant, Livret A, Vacances..."
          [(ngModel)]="newAccount().label"
        />
      </div>
      <div class="form-group">
        <label for="initialBalance">Solde initial (€) :</label>

        <input
          id="initialBalance"
          type="number"
          min="0"
          step="0.01"
          [(ngModel)]="newAccount().initialBalance"
        />
      </div>

      <div class="error" *ngIf="createError()">
        {{ createError() }}

      </div>
      <div class="error" *ngIf="createError()">{{ createError() }}</div>
      <div class="form-actions">
        <button
          class="btn-create"
          (click)="createNewAccount()"
          [disabled]="createLoading()">
          {{ createLoading() ? 'Création en cours...' : 'Créer le compte' }}
        </button>

        <button
          class="btn-cancel"
          (click)="closeCreateForm()"
          [disabled]="createLoading()">
          Annuler

        </button>
        <button class="btn-cancel" (click)="closeCreateForm()" [disabled]="createLoading()">Annuler</button>
      </div>
    </div>
  </div>

  <ng-template #noAccounts>
    <p>Aucun compte trouvé pour cet utilisateur.</p>
    <button (click)="openCreateForm()">Ouvrir un premier compte</button>
  </ng-template>
</div>
