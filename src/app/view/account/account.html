<div class="account-root">
  <h2>Mon espace compte</h2>

  <!-- Bienvenue utilisateur -->
  <div class="welcome">
    {{ user ? 'Bienvenue, ' + user.name : '' }}
  </div>

  <!-- Messages globaux -->
  <div class="error">{{ error() || '' }}</div>
  <div class="loading">{{ loading() ? 'Chargement...' : '' }}</div>

  <!-- Contenu principal -->
  <div *ngIf="!loading() && accounts().length > 0; else noAccounts">

    <!-- Sélection du compte -->
    <div class="account-selector">
      <label for="accountSelect">Choisir un compte :</label>
      <select id="accountSelect" (change)="onAccountChange($event)">
        <option
          *ngFor="let acc of accounts()"
          [value]="acc.id"
          [selected]="account() && account()!.id === acc.id">
          {{ acc.label || acc.id }} — {{ acc.balance | currency:'EUR':'symbol':'1.2-2' }}
        </option>
      </select>
    </div>

    <!-- Détails du compte sélectionné -->
    <section class="account-details" *ngIf="account()">
      <h3>{{ account()!.label || 'Compte ' + account()!.id }}</h3>
      <p><strong>Solde :</strong> {{ account()!.balance | currency:'EUR':'symbol':'1.2-2' }}</p>
      <p><strong>Ouvert le :</strong> {{ account()!.openAt | date:'dd/MM/yyyy HH:mm' }}</p>

      <div class="actions">
        <button (click)="onInfosClick()">Infos</button>
        <button (click)="onSendClick()">Envoyer</button>
        <button (click)="onOpenClick()">Ouvrir un nouveau compte</button>
        <button (click)="onViewAllClick()">Historique transactions</button>
      </div>
    </section>

    <!-- Formulaire de création (apparait quand showCreateForm = true) -->
    <div *ngIf="showCreateForm()" class="create-form">
      <h3>Créer un nouveau compte</h3>

      <div class="form-group">
        <label for="label">Nom / Libellé :</label>
        <input
          id="label"
          type="text"
          placeholder="ex: Compte Courant, Livret A, Vacances..."
          [(ngModel)]="newAccount().label"
        />
      </div>

      <div class="form-group">
        <label for="initialBalance">Solde initial (€) :</label>
        <input
          id="initialBalance"
          type="number"
          min="0"
          step="0.01"
          [(ngModel)]="newAccount().initialBalance"
        />
      </div>

      <div class="error" *ngIf="createError()">
        {{ createError() }}
      </div>

      <div class="form-actions">
        <button
          class="btn-create"
          (click)="createNewAccount()"
          [disabled]="createLoading()">
          {{ createLoading() ? 'Création en cours...' : 'Créer le compte' }}
        </button>

        <button
          class="btn-cancel"
          (click)="closeCreateForm()"
          [disabled]="createLoading()">
          Annuler
        </button>
      </div>
    </div>
  </div>

  <!-- Cas aucun compte -->
  <ng-template #noAccounts>
    <p>Aucun compte trouvé pour cet utilisateur.</p>
    <button (click)="openCreateForm()">Ouvrir un premier compte</button>
  </ng-template>
</div>
